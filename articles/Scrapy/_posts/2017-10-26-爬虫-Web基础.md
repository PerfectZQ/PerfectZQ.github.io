---
layout: post
title: 爬虫-Web基础
tag: Spider
---

## HTTP/1.1 协议 header
　　通常HTTP包含**Request请求消息**和**Response响应消息**两种消息。这两种消息都是由一个起始行、一个或多个头域、一个代表头域结束的空行和可选的消息体组成。例如一个Request请求消息：
```console
# 下面是起始行
GET /UpdateCheck.aspx?isBeta=False HTTP/1.1
# 下面是多个头域
 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
 Accept-Encoding: gzip, deflate
 Accept-Language: zh-CN,zh;q=0.8
 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36
# 下面是代表头域结束的空行

```

　　头域分为**通用头域**、**请求头域**、**响应头域**和**实体头域**四种。每个头域由一个域的名称、冒号和域值三部分组成，\[例如： (域名)Referer(冒号):(域值)http://download.google.com/]。域名是大小写无关的，域值前可以添加任何数量的空格符，头域可以被扩展为多行，在每行开始处，使用至少一个空格和制表符。

　　**通用头域**：Request请求消息和Response响应消息都支持的头域。通用头域包含Cache-Control、Connection、Date、Pragma、Transfer-Encoding、Upgrade、Via。对通用头域的扩展要求通讯双方都支持此扩展，如果存在不支持的通用头域，一般将会作为实体头域处理。

　　Cache-Control：指定请求和响应遵循的缓存机制。在请求消息或响应消息中设置Cache-Control并不会修改另一个消息处理过程中的缓存处理过程。请求时的缓存指令包括no-cache、no-store、max-age、max-stale、min-fresh、only-if-cached，响应消息中的指令包括public、private、no-cache、no-store、no-transform、must-revalidate、proxy-revalidate、max-age。例如：Cache-Control: no-cache  

　　Connection：表示是否需要持久连接。如果web服务器端看到这里的值为“Keep-Alive”，或者看到请求使用的是HTTP 1.1（HTTP 1.1默认进行持久连接），它就可以利用持久连接的优点，当页面包含多个元素时（例如Applet，图片），显著地减少下载所需要的时间。要实现这一点， web服务器需要在返回给客户端HTTP头信息中发送一个Content-Length（返回信息正文的长度）头，最简单的实现方法是：先把内容写入ByteArrayOutputStream，然 后在正式写出内容之前计算它的大小。例如：Connection: keep-alive  

　　Date：消息发送的时间，时间的描述格式由rfc822定义。例如，Date:Mon,31Dec200104:25:57GMT。Date描述的时间表示世界标准时，换算成本地时间，需要知道用户所在的时区。例如：Date: Tue, 15 Nov 2010 08:12:31 GMT  

　　Pragma：包含实现特定的指令，最常用的是Pragma:no-cache。在HTTP/1.1协议中，它的含义和Cache-Control:no-cache相同。例如：Pragma: no-cache  

　　Transfer-Encoding：告知接收端为了保证报文的可靠传输,对报文采用了什么编码方式。例如：Transfer-Encoding:chunked  

　　Upgrade：给出了发送端可能想要"升级"使用的新版本和协议  

　　Via：显示了报文经过的中间节点(代理)。例如：Via: 1.0 fred, 1.1 nowhere.com (Apache/1.1)  

　　**实体头域**：描述了实体内容的属性，包括实体信息类型，长度，压缩方法，最后一次修改时间，数据有效性等

　　Allow：服务器支持哪些请求方法（如GET、POST等）。     
  
　　Content-Encoding：文档的编码（Encode）方法。只有在解码之后才可以得到Content-Type头指定的内容类型。利用gzip压缩文档能够显著地减少HTML文档的 下载时间。Java的GZIPOutputStream可以很方便地进行gzip压缩，但只有Unix上的Netscape和Windows上的IE 4、IE 5才支持它。因此，Servlet应该通过查看Accept-Encoding头（即request.getHeader("Accept- Encoding")）检查浏览器是否支持gzip，为支持gzip的浏览器返回经gzip压缩的HTML页面，为其他浏览器返回普通页面。     

　　Content-Length：表示内容长度。只有当浏览器使用持久HTTP连接时才需要这个数据。如果你想要利用持久连接的优势，可以把输出文档写入 ByteArrayOutputStram，完成后查看其大小，然后把该值放入Content-Length头，最后通过byteArrayStream.writeTo(response.getOutputStream()发送内容。     

　　Content-Type：表示后面的文档属于什么MIME类型，一般只有post提交时才需要设置该属性。     

　　Content-Language：内容的语言类型，例如：zh-cn；     

　　Content-Location：表示客户端应当到哪里去提取文档     
  
　　Content-Range：随部分实体一同发送；标明被插入字节的低位与高位字节偏移，也标明此实体的总长度。     

　　Expires：为0证明不缓存     

　　Last-Modified：WEB服务器认为对象的最后修改时间，比如文件的最后修改时间，动态页面的最后产生时间等等。   Last-Modified：Tue, 06 May 2008 02:42:43 GMT.  

　　**请求头域**和**响应头域**在下面介绍。

### Request请求消息：
```console
# Request请求消息的格式如下
MethodSPRequest-URISPHTTP-VersionCRLF
```

　　其中SP代表空格，CRLF代表回车。实际是下面的样子：
```consle
Method Request-URI HTTP-Version
...
...

```    
　　Method 表示对Request-URI所使用的方法，这个字段是大小写铭敏感的，包括OPTIONS、GET、HEAD、POST、PUT、DELETE、TRACE。其中GET和HEAD方法都是请求返回Request-URI所标识的信息，区别就是HEAD在响应时可以不返回消息体。POST可以在请求服务器的同时附加上实体信息，例如表单信息。
　　
　　Request-URI 遵循URI格式，如果此字段是星号(*)，说明请求并用于某个特定的资源地址，而是用于服务器本身

　　HTTP-Version 表示支持的HTTP版本。例如HTTP/1.1。

　　除此之外，请求头还允许客户端向服务器传递关于客户端和请求的附加信息。请求头域可能包含Accept、Accept-Charset、Accept-Encoding、Accept-Language、Authorization、From、Host、If-Modified-Since、If-Match、If-None-Match、If-Range、If-Range、If-Unmodified-Since、Max-Forwards、 Proxy-Authorization、Range、Referer、User-Agent。对于这些扩展要求通讯双方都支持、如果存在不支持的请求域，一般会将其当成实体头域来处理。

　　典型的请求消息：
```consle
GET http://download.google.com/somedata.exe 
 Host: download.google.com
 Accept:*/* 
 Pragma: no-cache 
 Cache-Control: no-cache 
 Referer: http://download.google.com/ 
 User-Agent:Mozilla/4.04[en](Win95;I;Nav) 
 Range:bytes=554554- 

```

　　请求头域介绍：
  
　　Accept：指定客户端能够接收的内容类型，内容类型中的先后次序表示客户端接收的先后次序。例如：Accept:text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5  
  
　　Accept-Charset：浏览器可以接受的字符编码集。例如：Accept-Charset: gb2312,utf-8;q=0.7,*;q=0.7  
　　
　　Accept-Encoding：指定客户端浏览器可以支持的web服务器返回内容压缩编码类型。表示允许服务器在将输出内容发送到客户端以前进行压缩，以节约带宽。而这里设置的就是客户端浏览器所能够支持的返回压缩格式。例如：Accept-Encoding: gzip,deflate  

　　Accept-Language：指定HTTP客户端浏览器用来展示返回信息所优先选择的语言。例如：Accept-Language: zh-cn,zh;q=0.5  

　　Authorization：    

　　From：

　　Host：指定请求资源的Internet主机和端口号，必须表示请求url的原始服务器或网关的位置。HTTP/1.1请求必须包含主机头域，否则系统会以400状态码返回。

　　Referer：允许客户端指定请求uri的源资源地址，这可以允许服务器生成回退链表，可用来登陆、优化cache等。他也允许追踪出于维护的目的废除的或错误的连接。如果请求的uri没有自己的uri地址，Referer不能被发送。如果指定的是部分uri地址，则此地址应该是一个相对地址。

　　User-Agent：发出请求的客户端的信息（浏览器信息）。

　　Range：可以请求实体的一个或者多个子范围。如：bytes=0-499表示头500个字节，bytes=500-999 表示第二个500字节，bytes=-500 表示最后500个字节，bytes=500- 表示500字节以后的范围，bytes=0-0,-1 表示第一个和最后一个字节，bytes=500-600,601-999 表示同时指定几个范围。服务器可以忽略此请求头，如果无条件的GET包含Range请求头，响应会以状态码206（PartialContent）返回而不是以200（OK）。

　　If-Modified-Since：       

　　If-Match：

　　If-None-Match：

　　If-Range：        

　　If-Unmodified-Since：        

　　Max-Forwards：    

　　Proxy-Authorization：        

### Response响应消息：
```console
# Response响应消息的格式如下
HTTP-VersionSPStatus-CodeSPReason-PhraseCRLF 
```

　　其中SP代表空格，CRLF代表回车。实际是下面的样子：
```consle
HTTP-Version Status-Code Reason-Phrase 
...
...

```

　　**Status-Code**是一个三位数的结果代码。可以分为5种。

  状态码   介绍  
  :--------   :--------  
  1xx   信息状态码。表示该请求已经被接受，正在被处理  
  2xx   正确状态码。表示该请求已经被接受并处理，且没有错误发生。例如200（OK）表示一切正常。  
  3xx   重定向状态码。例如301、302表示该资源已经不存在或者换了地址，客户端需要重新定向到一个信的资源。服务器响应中会附带这个新资源地址。  
  4xx   请求错误。401表示没有权限访问、404表示资源不存在、405表示访问方式错误（例如Servlet只接受GET和POST，但是客户端却以DELETE方式访问）  
  5xx   服务器错误。例如500表示程序出现异常而中途停止运行。  

　　**Reason-Phrase**主要用于帮助用户理解。

　　除此之外，响应头还允许服务器传递无法放在状态行的附加信息，它们主要描述服务器的信息和Request-URI进一步的信息。响应头域包含Age、Location、Proxy-Authenticate、Public、Retry-After、Server、Vary、Warning、WWW-Authenticate。对响应头域的扩展要求通讯双方都支持，如果存在不支持的响应头域，一般将会作为实体头域处理。 

　　典型的响应消息：
```console
HTTP/1.0 200 OK 
 Date:Mon,31Dec200104:25:57GMT 
 Server:Apache/1.3.14(Unix) 
 Content-type:text/html 
 Last-modified:Tue,17Apr200106:46:28GMT 
 Etag:"a030f020ac7c01:1e9f" 
 Content-length:39725426 
 Content-range:bytes554554-40279979/40279980 

```

　　响应头域：

　　Age        

　　Location        

　　Proxy-Authenticate        

　　Public        

　　Retry-After        

　　Server        

　　Vary        

　　Warning        

　　WWW-Authenticate        

## cookie