---
layout: post
title: Docker 入门
tag:  Docker
---
## 下载
http://download.docker.com

## Docker 命令查看
```shell
# 查看 docker 命令的 options 和 command
docker --help
# 查看具体 command 的使用方式
docker command --help
```

## docker 命令
### 查看 docker 容器信息
```shell
# 查看 docker 所有容器和镜像的数量、docker 使用的执行驱动和存储驱动以及 docker 的基本配置。
# 可以通过这个命令查看 docker 是否安装成功
docker info

# 查看正在运行的容器
docker ps

# 查看所有的容器，包括已经停止的容器
docker ps -a

# 查看最后 x 个容器，不论容器是否停止
docker ps -n 3

# 查看容器内的进程
docker top CONTAINER

# 查看一到多个容器的统计信息，例如：CPU、内存、网络I/O、存储I/O的性能和指标，常用于快速监控
docker status CONTAINER1 CONTAINER2 CONTAINER2 ...

# 对容器进行详细的检查，然后返回 json 格式的配置信息，如：名称、命令、网络配置以及很多有用的数据
docker inspect CONTAINER
# 可以使用 -f 或者 --format 选定某项结果，其实这个参数支持完整的 GO 语言模版
docker inspect --format='{{.State.Running}}' CONTAINER
```

### docker 创建/启动、停止、删除容器
```shell
# run 创建、启动一个新的容器
# -i 保证容器中STDIN是开启的，尽管我们没有 attach 到容器中
# -t 为创建的容器分配一个伪 tty 终端
# -i 和 -t 两个参数同时存在，新建的容器才能提供一个交互式 shell
# /bin/bash 执行容器中的 shell
docker run -it ubuntu /bin/bash

# 其中 fd2dcda313a4 是容器 id，(hostname)
root@fd2dcda313a4:/#

# 退出 shell，这样容器也会跟着停止
root@fd2dcda313a4:/# exit

# 创建守护式容器(daemonized container)
# -d docker 会将容器放到后台运行，执行完后，他不会像 -it 一样将主机的控制台
# 附着到新的shell会话上，而是仅仅返回了一个容器ID
docker run -d ubuntu /bin/sh -c "while true; do echo hello world; sleep 1; done"

# 为容器命名，这样就不一定非要用容器id去访问容器了，但是容器的命名必须是唯一的
docker run --name test_container -i -t centos /bin/bash

# 附着到正在运行容器的会话，可能需要回车才能进入会话
docker attach CONTAINER

# 在容器内部运行额外的进程(docker 1.3+)
# 例如进入容器内 shell 会话
docker exec -it CONTAINER /bin/bash
# 启动一个新的后台任务
docekr exec -d CONTAINER touch /etc/new-config-file

# 停止守护式容器，向 docker 容器进程发送 SIGTERM 信号
docker stop CONTAINER

# 如果想快速停止某个容器，还可以直接向 docker 容器进程发送 SIGKILL 信号
docker kill CONTAINER

# 重新启动已经停止的 container，docekr 重启的时候会沿用 docker run 时指定的参数来运行。
docker start CONTAINER

# 自动重启容器 --restart
# --restart=always 无论容器的退出代码是什么，docker 都会重新启动该容器
docker run --restart=always -d ubuntu /bin/sh -c "while true; do echo hello world; sleep 1; done"
# --restart=on-failure 只有当容器的退出代码为非0值的时候才会自动重启，除此之外还可以接收一个重启次数的参数
docker run --restart=on-failure:5 -d ubuntu /bin/sh -c "while true; do echo hello world; sleep 1; done"

# 删除容器(从这里开始，CONTAINER 代表容器ID/容器名)
docker rm CONTAINER
```

### docker 查看容器日志
```shell
# 获取 docker 内部最新的日志
docker logs CONTAINER

# -f 滚动输出日志，类似 tail -f
# --tail 10 返回最后10条日志，每次
docker logs -f --tail 10 CONTAINER

# docker1.6起，可以控制 docekr 所用的日志驱动，在 docker run 时，使用 --log-driver 进行控制
# --log-driver 默认 json-file 还有其他可用选项，如：
# syslog 该选项禁用 docker logs 命令，并将所有容器的日志输出都重定向到 syslog
# none 该选项也会禁用所有容器中的日志，导致 docker logs 不可用
# 1.8 之后还有 fluentd 日志轮转驱动等等
docker run --log-driver="syslog" -d ubuntu /bin/sh -c "while true; do echo hello world; sleep 1; done"
```

## 使用 Dockerfile 构建镜像
不推荐通过docker commit的方式构建镜像，而是通过Dockerfile的定义文件和docker build命令去构建镜像，这样构建的镜像更具备可重复性、透明性以及幂等性。

```shell
# 
mkdir static_web
cd static_web
touch Dockerfile

```