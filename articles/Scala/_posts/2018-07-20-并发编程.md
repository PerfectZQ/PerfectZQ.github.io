---
layout: post
title: 并发编程
tag: Java
---

## 多线程加1
多个线程同时对变量`i`加一，保证结果正确。
```scala
object Test {

  def main(args: Array[String]): Unit = {
    var i = 0
    val runnable = new Runnable {
      override def run(): Unit = {
        // 用来模拟一顿操作猛如虎
        Thread.sleep(200)
        // Note: this 是指当前 object Test，而不是 Thread 对象
        this.synchronized {
          i += 1
        }
      }
    }
    val threads = Range(0, 10000).map { _ => new Thread(runnable) }
    /**
     * Note: 多个线程的 start()、join() 要全部分开写，如果 
     * thread1.start(); thread1.join();
     * thread2.start(); thread2.join();
     * 这样写的话，虽然你创建了多个线程，但还是串行执行的，并没有并发。
     */
    threads.foreach(thread => thread.start())
    // 等所有线程都加完了(join)再输出，否则输出结果不对
    threads.foreach(thread => thread.join())
    println(i)
  }

}
```
